name: Add_Submodule

permissions:
  contents: write
  actions: write

on:
  workflow_dispatch:
    inputs:
      label:
        description: 'Repository Label'
        required: true
        default: ''
        type: string
      repo_name:
        description: 'Repository Name'
        required: true
        default: ''
        type: string
      branch:
        description: 'Default Branch'
        required: true
        default: 'main'
        type: string

jobs:
  add_submodule:
    runs-on: windows-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      
      - name: add-submodule
        shell: bash
        run: |
          # config
          git config --global user.name "$GITHUB_ACTOR"
          git config --global user.email "${GITHUB_ACTOR}@users.noreply.github.com"
          # add-submodule
          git submodule add -b ${{ inputs.branch }} https://github.com/$GITHUB_ACTOR/${{ inputs.repo_name }}
          git submodule init
          git submodule update
          git add .
          git commit -m "feat: add submodule ${{ inputs.repo_name }}"
          git push

      - name: update-README.md
        run: |
           sed -i '3i [![${{ inputs.repo_name }}](https://img.shields.io/static/v1?label=${{ inputs.label }}&message=${{ inputs.repo_name }}&color=blue)](https://github.com/$GITHUB_ACTOR/${{ inputs.repo_name }}/tree/${{ inputs.branch }}) ' README.md
           git add .
           git commit -m "chore: update README.md"
           git push
